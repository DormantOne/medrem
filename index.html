
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHF Medication Calendar Generator</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-width: 500px;
            width: 100%;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-size: 24px;
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid;
        }
        .am-section {
            background-color: #fff8e1;
            border-left-color: #ffc107; /* Amber for Morning */
        }
        .pm-section {
            background-color: #e8eaf6;
            border-left-color: #3f51b5; /* Indigo for Evening */
        }
        h2 {
            margin-top: 0;
            font-size: 18px;
            color: #444;
            display: flex;
            align-items: center;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            resize: vertical;
            font-family: inherit;
            box-sizing: border-box; /* Fixes padding issues */
        }
        .time-select {
            margin-bottom: 10px;
        }
        .time-select input {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        button {
            width: 100%;
            padding: 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }
        button:hover {
            background-color: #218838;
        }
        .note {
            font-size: 12px;
            color: #777;
            text-align: center;
            margin-top: 15px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>CHF Medication Schedule</h1>
    <p style="text-align:center; color:#666; font-size: 14px;">Enter your meds below to create a daily calendar schedule.</p>

    <!-- Morning Section -->
    <div class="section am-section">
        <h2>‚òÄÔ∏è Morning Medications</h2>
        
        <div class="time-select">
            <label for="amTime">Remind me every day at:</label>
            <input type="time" id="amTime" value="08:00">
        </div>

        <label for="amMeds">List your Morning Meds:</label>
        <textarea id="amMeds" placeholder="e.g., \n- Lasix 20mg\n- Lisinopril 10mg"></textarea>
    </div>

    <!-- Evening Section -->
    <div class="section pm-section">
        <h2>üåô Evening Medications</h2>
        
        <div class="time-select">
            <label for="pmTime">Remind me every day at:</label>
            <input type="time" id="pmTime" value="20:00">
        </div>

        <label for="pmMeds">List your Evening Meds:</label>
        <textarea id="pmMeds" placeholder="e.g., \n- Coreg 6.25mg\n- Baby Aspirin"></textarea>
    </div>

    <button onclick="generateCalendar()">Download Calendar File</button>
    <p class="note">This file works with Google Calendar, Outlook, and Apple Calendar.</p>
</div>

<script>
    function generateCalendar() {
        // 1. Get User Input
        const amMeds = document.getElementById('amMeds').value;
        const pmMeds = document.getElementById('pmMeds').value;
        const amTime = document.getElementById('amTime').value;
        const pmTime = document.getElementById('pmTime').value;

        if (!amMeds && !pmMeds) {
            alert("Please enter at least one medication.");
            return;
        }

        // 2. Helper to format date strings for ICS format (YYYYMMDDTHHmm00)
        function formatDate(dateString) {
            return dateString.replace(/[-:]/g, '') + '00';
        }

        // 3. Create a start date (Tomorrow) to begin the recurring schedule
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        const year = tomorrow.getFullYear();
        const month = String(tomorrow.getMonth() + 1).padStart(2, '0');
        const day = String(tomorrow.getDate()).padStart(2, '0');
        const datePrefix = `${year}${month}${day}`;

        // 4. Build the ICS File Content
        let icsContent = "BEGIN:VCALENDAR\r\nVERSION:2.0\r\nPRODID:-//CHF Med Tracker//EN\r\n";

        // Add Morning Event if data exists
        if (amMeds) {
            const [hrs, mins] = amTime.split(':');
            const startStr = `${datePrefix}T${hrs}${mins}00`;
            // End time is 15 mins after start
            let endDateObj = new Date(year, parseInt(month)-1, parseInt(day), parseInt(hrs), parseInt(mins) + 15);
            const endStr = endDateObj.toISOString().replace(/[-:]/g, '').split('.')[0] + "Z"; // Fallback calc (simplified below)
            
            // Note: We use Floating time (no Z) for start to respect user's local time zone on import
            icsContent += `BEGIN:VEVENT\r\n` +
                          `SUMMARY:‚òÄÔ∏è Morning CHF Meds\r\n` +
                          `DTSTART:${startStr}\r\n` +
                          `RRULE:FREQ=DAILY\r\n` +
                          `DESCRIPTION:Take the following:\\n${amMeds.replace(/\n/g, '\\n')}\r\n` +
                          `BEGIN:VALARM\r\nTRIGGER:-PT5M\r\nACTION:DISPLAY\r\nDESCRIPTION:Time for AM Meds\r\nEND:VALARM\r\n` +
                          `END:VEVENT\r\n`;
        }

        // Add Evening Event if data exists
        if (pmMeds) {
            const [hrs, mins] = pmTime.split(':');
            const startStr = `${datePrefix}T${hrs}${mins}00`;
            
            icsContent += `BEGIN:VEVENT\r\n` +
                          `SUMMARY:üåô Evening CHF Meds\r\n` +
                          `DTSTART:${startStr}\r\n` +
                          `RRULE:FREQ=DAILY\r\n` +
                          `DESCRIPTION:Take the following:\\n${pmMeds.replace(/\n/g, '\\n')}\r\n` +
                          `BEGIN:VALARM\r\nTRIGGER:-PT5M\r\nACTION:DISPLAY\r\nDESCRIPTION:Time for PM Meds\r\nEND:VALARM\r\n` +
                          `END:VEVENT\r\n`;
        }

        icsContent += "END:VCALENDAR";

        // 5. Trigger Download
        const blob = new Blob([icsContent], { type: 'text/calendar' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'medication_schedule.ics';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
</script>

</body>
</html>
